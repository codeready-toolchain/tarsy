// Code generated by ent, DO NOT EDIT.

package ent

import (
	"context"
	"errors"
	"fmt"

	"entgo.io/ent/dialect/sql"
	"entgo.io/ent/dialect/sql/sqlgraph"
	"entgo.io/ent/schema/field"
	"github.com/codeready-toolchain/tarsy/ent/llminteraction"
	"github.com/codeready-toolchain/tarsy/ent/message"
	"github.com/codeready-toolchain/tarsy/ent/predicate"
	"github.com/codeready-toolchain/tarsy/ent/timelineevent"
)

// LLMInteractionUpdate is the builder for updating LLMInteraction entities.
type LLMInteractionUpdate struct {
	config
	hooks    []Hook
	mutation *LLMInteractionMutation
}

// Where appends a list predicates to the LLMInteractionUpdate builder.
func (_u *LLMInteractionUpdate) Where(ps ...predicate.LLMInteraction) *LLMInteractionUpdate {
	_u.mutation.Where(ps...)
	return _u
}

// SetInteractionType sets the "interaction_type" field.
func (_u *LLMInteractionUpdate) SetInteractionType(v llminteraction.InteractionType) *LLMInteractionUpdate {
	_u.mutation.SetInteractionType(v)
	return _u
}

// SetNillableInteractionType sets the "interaction_type" field if the given value is not nil.
func (_u *LLMInteractionUpdate) SetNillableInteractionType(v *llminteraction.InteractionType) *LLMInteractionUpdate {
	if v != nil {
		_u.SetInteractionType(*v)
	}
	return _u
}

// SetModelName sets the "model_name" field.
func (_u *LLMInteractionUpdate) SetModelName(v string) *LLMInteractionUpdate {
	_u.mutation.SetModelName(v)
	return _u
}

// SetNillableModelName sets the "model_name" field if the given value is not nil.
func (_u *LLMInteractionUpdate) SetNillableModelName(v *string) *LLMInteractionUpdate {
	if v != nil {
		_u.SetModelName(*v)
	}
	return _u
}

// SetLastMessageID sets the "last_message_id" field.
func (_u *LLMInteractionUpdate) SetLastMessageID(v string) *LLMInteractionUpdate {
	_u.mutation.SetLastMessageID(v)
	return _u
}

// SetNillableLastMessageID sets the "last_message_id" field if the given value is not nil.
func (_u *LLMInteractionUpdate) SetNillableLastMessageID(v *string) *LLMInteractionUpdate {
	if v != nil {
		_u.SetLastMessageID(*v)
	}
	return _u
}

// ClearLastMessageID clears the value of the "last_message_id" field.
func (_u *LLMInteractionUpdate) ClearLastMessageID() *LLMInteractionUpdate {
	_u.mutation.ClearLastMessageID()
	return _u
}

// SetLlmRequest sets the "llm_request" field.
func (_u *LLMInteractionUpdate) SetLlmRequest(v map[string]interface{}) *LLMInteractionUpdate {
	_u.mutation.SetLlmRequest(v)
	return _u
}

// SetLlmResponse sets the "llm_response" field.
func (_u *LLMInteractionUpdate) SetLlmResponse(v map[string]interface{}) *LLMInteractionUpdate {
	_u.mutation.SetLlmResponse(v)
	return _u
}

// SetThinkingContent sets the "thinking_content" field.
func (_u *LLMInteractionUpdate) SetThinkingContent(v string) *LLMInteractionUpdate {
	_u.mutation.SetThinkingContent(v)
	return _u
}

// SetNillableThinkingContent sets the "thinking_content" field if the given value is not nil.
func (_u *LLMInteractionUpdate) SetNillableThinkingContent(v *string) *LLMInteractionUpdate {
	if v != nil {
		_u.SetThinkingContent(*v)
	}
	return _u
}

// ClearThinkingContent clears the value of the "thinking_content" field.
func (_u *LLMInteractionUpdate) ClearThinkingContent() *LLMInteractionUpdate {
	_u.mutation.ClearThinkingContent()
	return _u
}

// SetResponseMetadata sets the "response_metadata" field.
func (_u *LLMInteractionUpdate) SetResponseMetadata(v map[string]interface{}) *LLMInteractionUpdate {
	_u.mutation.SetResponseMetadata(v)
	return _u
}

// ClearResponseMetadata clears the value of the "response_metadata" field.
func (_u *LLMInteractionUpdate) ClearResponseMetadata() *LLMInteractionUpdate {
	_u.mutation.ClearResponseMetadata()
	return _u
}

// SetInputTokens sets the "input_tokens" field.
func (_u *LLMInteractionUpdate) SetInputTokens(v int) *LLMInteractionUpdate {
	_u.mutation.ResetInputTokens()
	_u.mutation.SetInputTokens(v)
	return _u
}

// SetNillableInputTokens sets the "input_tokens" field if the given value is not nil.
func (_u *LLMInteractionUpdate) SetNillableInputTokens(v *int) *LLMInteractionUpdate {
	if v != nil {
		_u.SetInputTokens(*v)
	}
	return _u
}

// AddInputTokens adds value to the "input_tokens" field.
func (_u *LLMInteractionUpdate) AddInputTokens(v int) *LLMInteractionUpdate {
	_u.mutation.AddInputTokens(v)
	return _u
}

// ClearInputTokens clears the value of the "input_tokens" field.
func (_u *LLMInteractionUpdate) ClearInputTokens() *LLMInteractionUpdate {
	_u.mutation.ClearInputTokens()
	return _u
}

// SetOutputTokens sets the "output_tokens" field.
func (_u *LLMInteractionUpdate) SetOutputTokens(v int) *LLMInteractionUpdate {
	_u.mutation.ResetOutputTokens()
	_u.mutation.SetOutputTokens(v)
	return _u
}

// SetNillableOutputTokens sets the "output_tokens" field if the given value is not nil.
func (_u *LLMInteractionUpdate) SetNillableOutputTokens(v *int) *LLMInteractionUpdate {
	if v != nil {
		_u.SetOutputTokens(*v)
	}
	return _u
}

// AddOutputTokens adds value to the "output_tokens" field.
func (_u *LLMInteractionUpdate) AddOutputTokens(v int) *LLMInteractionUpdate {
	_u.mutation.AddOutputTokens(v)
	return _u
}

// ClearOutputTokens clears the value of the "output_tokens" field.
func (_u *LLMInteractionUpdate) ClearOutputTokens() *LLMInteractionUpdate {
	_u.mutation.ClearOutputTokens()
	return _u
}

// SetTotalTokens sets the "total_tokens" field.
func (_u *LLMInteractionUpdate) SetTotalTokens(v int) *LLMInteractionUpdate {
	_u.mutation.ResetTotalTokens()
	_u.mutation.SetTotalTokens(v)
	return _u
}

// SetNillableTotalTokens sets the "total_tokens" field if the given value is not nil.
func (_u *LLMInteractionUpdate) SetNillableTotalTokens(v *int) *LLMInteractionUpdate {
	if v != nil {
		_u.SetTotalTokens(*v)
	}
	return _u
}

// AddTotalTokens adds value to the "total_tokens" field.
func (_u *LLMInteractionUpdate) AddTotalTokens(v int) *LLMInteractionUpdate {
	_u.mutation.AddTotalTokens(v)
	return _u
}

// ClearTotalTokens clears the value of the "total_tokens" field.
func (_u *LLMInteractionUpdate) ClearTotalTokens() *LLMInteractionUpdate {
	_u.mutation.ClearTotalTokens()
	return _u
}

// SetDurationMs sets the "duration_ms" field.
func (_u *LLMInteractionUpdate) SetDurationMs(v int) *LLMInteractionUpdate {
	_u.mutation.ResetDurationMs()
	_u.mutation.SetDurationMs(v)
	return _u
}

// SetNillableDurationMs sets the "duration_ms" field if the given value is not nil.
func (_u *LLMInteractionUpdate) SetNillableDurationMs(v *int) *LLMInteractionUpdate {
	if v != nil {
		_u.SetDurationMs(*v)
	}
	return _u
}

// AddDurationMs adds value to the "duration_ms" field.
func (_u *LLMInteractionUpdate) AddDurationMs(v int) *LLMInteractionUpdate {
	_u.mutation.AddDurationMs(v)
	return _u
}

// ClearDurationMs clears the value of the "duration_ms" field.
func (_u *LLMInteractionUpdate) ClearDurationMs() *LLMInteractionUpdate {
	_u.mutation.ClearDurationMs()
	return _u
}

// SetErrorMessage sets the "error_message" field.
func (_u *LLMInteractionUpdate) SetErrorMessage(v string) *LLMInteractionUpdate {
	_u.mutation.SetErrorMessage(v)
	return _u
}

// SetNillableErrorMessage sets the "error_message" field if the given value is not nil.
func (_u *LLMInteractionUpdate) SetNillableErrorMessage(v *string) *LLMInteractionUpdate {
	if v != nil {
		_u.SetErrorMessage(*v)
	}
	return _u
}

// ClearErrorMessage clears the value of the "error_message" field.
func (_u *LLMInteractionUpdate) ClearErrorMessage() *LLMInteractionUpdate {
	_u.mutation.ClearErrorMessage()
	return _u
}

// SetLastMessage sets the "last_message" edge to the Message entity.
func (_u *LLMInteractionUpdate) SetLastMessage(v *Message) *LLMInteractionUpdate {
	return _u.SetLastMessageID(v.ID)
}

// AddTimelineEventIDs adds the "timeline_events" edge to the TimelineEvent entity by IDs.
func (_u *LLMInteractionUpdate) AddTimelineEventIDs(ids ...string) *LLMInteractionUpdate {
	_u.mutation.AddTimelineEventIDs(ids...)
	return _u
}

// AddTimelineEvents adds the "timeline_events" edges to the TimelineEvent entity.
func (_u *LLMInteractionUpdate) AddTimelineEvents(v ...*TimelineEvent) *LLMInteractionUpdate {
	ids := make([]string, len(v))
	for i := range v {
		ids[i] = v[i].ID
	}
	return _u.AddTimelineEventIDs(ids...)
}

// Mutation returns the LLMInteractionMutation object of the builder.
func (_u *LLMInteractionUpdate) Mutation() *LLMInteractionMutation {
	return _u.mutation
}

// ClearLastMessage clears the "last_message" edge to the Message entity.
func (_u *LLMInteractionUpdate) ClearLastMessage() *LLMInteractionUpdate {
	_u.mutation.ClearLastMessage()
	return _u
}

// ClearTimelineEvents clears all "timeline_events" edges to the TimelineEvent entity.
func (_u *LLMInteractionUpdate) ClearTimelineEvents() *LLMInteractionUpdate {
	_u.mutation.ClearTimelineEvents()
	return _u
}

// RemoveTimelineEventIDs removes the "timeline_events" edge to TimelineEvent entities by IDs.
func (_u *LLMInteractionUpdate) RemoveTimelineEventIDs(ids ...string) *LLMInteractionUpdate {
	_u.mutation.RemoveTimelineEventIDs(ids...)
	return _u
}

// RemoveTimelineEvents removes "timeline_events" edges to TimelineEvent entities.
func (_u *LLMInteractionUpdate) RemoveTimelineEvents(v ...*TimelineEvent) *LLMInteractionUpdate {
	ids := make([]string, len(v))
	for i := range v {
		ids[i] = v[i].ID
	}
	return _u.RemoveTimelineEventIDs(ids...)
}

// Save executes the query and returns the number of nodes affected by the update operation.
func (_u *LLMInteractionUpdate) Save(ctx context.Context) (int, error) {
	return withHooks(ctx, _u.sqlSave, _u.mutation, _u.hooks)
}

// SaveX is like Save, but panics if an error occurs.
func (_u *LLMInteractionUpdate) SaveX(ctx context.Context) int {
	affected, err := _u.Save(ctx)
	if err != nil {
		panic(err)
	}
	return affected
}

// Exec executes the query.
func (_u *LLMInteractionUpdate) Exec(ctx context.Context) error {
	_, err := _u.Save(ctx)
	return err
}

// ExecX is like Exec, but panics if an error occurs.
func (_u *LLMInteractionUpdate) ExecX(ctx context.Context) {
	if err := _u.Exec(ctx); err != nil {
		panic(err)
	}
}

// check runs all checks and user-defined validators on the builder.
func (_u *LLMInteractionUpdate) check() error {
	if v, ok := _u.mutation.InteractionType(); ok {
		if err := llminteraction.InteractionTypeValidator(v); err != nil {
			return &ValidationError{Name: "interaction_type", err: fmt.Errorf(`ent: validator failed for field "LLMInteraction.interaction_type": %w`, err)}
		}
	}
	if _u.mutation.SessionCleared() && len(_u.mutation.SessionIDs()) > 0 {
		return errors.New(`ent: clearing a required unique edge "LLMInteraction.session"`)
	}
	if _u.mutation.StageCleared() && len(_u.mutation.StageIDs()) > 0 {
		return errors.New(`ent: clearing a required unique edge "LLMInteraction.stage"`)
	}
	if _u.mutation.AgentExecutionCleared() && len(_u.mutation.AgentExecutionIDs()) > 0 {
		return errors.New(`ent: clearing a required unique edge "LLMInteraction.agent_execution"`)
	}
	return nil
}

func (_u *LLMInteractionUpdate) sqlSave(ctx context.Context) (_node int, err error) {
	if err := _u.check(); err != nil {
		return _node, err
	}
	_spec := sqlgraph.NewUpdateSpec(llminteraction.Table, llminteraction.Columns, sqlgraph.NewFieldSpec(llminteraction.FieldID, field.TypeString))
	if ps := _u.mutation.predicates; len(ps) > 0 {
		_spec.Predicate = func(selector *sql.Selector) {
			for i := range ps {
				ps[i](selector)
			}
		}
	}
	if value, ok := _u.mutation.InteractionType(); ok {
		_spec.SetField(llminteraction.FieldInteractionType, field.TypeEnum, value)
	}
	if value, ok := _u.mutation.ModelName(); ok {
		_spec.SetField(llminteraction.FieldModelName, field.TypeString, value)
	}
	if value, ok := _u.mutation.LlmRequest(); ok {
		_spec.SetField(llminteraction.FieldLlmRequest, field.TypeJSON, value)
	}
	if value, ok := _u.mutation.LlmResponse(); ok {
		_spec.SetField(llminteraction.FieldLlmResponse, field.TypeJSON, value)
	}
	if value, ok := _u.mutation.ThinkingContent(); ok {
		_spec.SetField(llminteraction.FieldThinkingContent, field.TypeString, value)
	}
	if _u.mutation.ThinkingContentCleared() {
		_spec.ClearField(llminteraction.FieldThinkingContent, field.TypeString)
	}
	if value, ok := _u.mutation.ResponseMetadata(); ok {
		_spec.SetField(llminteraction.FieldResponseMetadata, field.TypeJSON, value)
	}
	if _u.mutation.ResponseMetadataCleared() {
		_spec.ClearField(llminteraction.FieldResponseMetadata, field.TypeJSON)
	}
	if value, ok := _u.mutation.InputTokens(); ok {
		_spec.SetField(llminteraction.FieldInputTokens, field.TypeInt, value)
	}
	if value, ok := _u.mutation.AddedInputTokens(); ok {
		_spec.AddField(llminteraction.FieldInputTokens, field.TypeInt, value)
	}
	if _u.mutation.InputTokensCleared() {
		_spec.ClearField(llminteraction.FieldInputTokens, field.TypeInt)
	}
	if value, ok := _u.mutation.OutputTokens(); ok {
		_spec.SetField(llminteraction.FieldOutputTokens, field.TypeInt, value)
	}
	if value, ok := _u.mutation.AddedOutputTokens(); ok {
		_spec.AddField(llminteraction.FieldOutputTokens, field.TypeInt, value)
	}
	if _u.mutation.OutputTokensCleared() {
		_spec.ClearField(llminteraction.FieldOutputTokens, field.TypeInt)
	}
	if value, ok := _u.mutation.TotalTokens(); ok {
		_spec.SetField(llminteraction.FieldTotalTokens, field.TypeInt, value)
	}
	if value, ok := _u.mutation.AddedTotalTokens(); ok {
		_spec.AddField(llminteraction.FieldTotalTokens, field.TypeInt, value)
	}
	if _u.mutation.TotalTokensCleared() {
		_spec.ClearField(llminteraction.FieldTotalTokens, field.TypeInt)
	}
	if value, ok := _u.mutation.DurationMs(); ok {
		_spec.SetField(llminteraction.FieldDurationMs, field.TypeInt, value)
	}
	if value, ok := _u.mutation.AddedDurationMs(); ok {
		_spec.AddField(llminteraction.FieldDurationMs, field.TypeInt, value)
	}
	if _u.mutation.DurationMsCleared() {
		_spec.ClearField(llminteraction.FieldDurationMs, field.TypeInt)
	}
	if value, ok := _u.mutation.ErrorMessage(); ok {
		_spec.SetField(llminteraction.FieldErrorMessage, field.TypeString, value)
	}
	if _u.mutation.ErrorMessageCleared() {
		_spec.ClearField(llminteraction.FieldErrorMessage, field.TypeString)
	}
	if _u.mutation.LastMessageCleared() {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.M2O,
			Inverse: true,
			Table:   llminteraction.LastMessageTable,
			Columns: []string{llminteraction.LastMessageColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(message.FieldID, field.TypeString),
			},
		}
		_spec.Edges.Clear = append(_spec.Edges.Clear, edge)
	}
	if nodes := _u.mutation.LastMessageIDs(); len(nodes) > 0 {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.M2O,
			Inverse: true,
			Table:   llminteraction.LastMessageTable,
			Columns: []string{llminteraction.LastMessageColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(message.FieldID, field.TypeString),
			},
		}
		for _, k := range nodes {
			edge.Target.Nodes = append(edge.Target.Nodes, k)
		}
		_spec.Edges.Add = append(_spec.Edges.Add, edge)
	}
	if _u.mutation.TimelineEventsCleared() {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.O2M,
			Inverse: false,
			Table:   llminteraction.TimelineEventsTable,
			Columns: []string{llminteraction.TimelineEventsColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(timelineevent.FieldID, field.TypeString),
			},
		}
		_spec.Edges.Clear = append(_spec.Edges.Clear, edge)
	}
	if nodes := _u.mutation.RemovedTimelineEventsIDs(); len(nodes) > 0 && !_u.mutation.TimelineEventsCleared() {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.O2M,
			Inverse: false,
			Table:   llminteraction.TimelineEventsTable,
			Columns: []string{llminteraction.TimelineEventsColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(timelineevent.FieldID, field.TypeString),
			},
		}
		for _, k := range nodes {
			edge.Target.Nodes = append(edge.Target.Nodes, k)
		}
		_spec.Edges.Clear = append(_spec.Edges.Clear, edge)
	}
	if nodes := _u.mutation.TimelineEventsIDs(); len(nodes) > 0 {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.O2M,
			Inverse: false,
			Table:   llminteraction.TimelineEventsTable,
			Columns: []string{llminteraction.TimelineEventsColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(timelineevent.FieldID, field.TypeString),
			},
		}
		for _, k := range nodes {
			edge.Target.Nodes = append(edge.Target.Nodes, k)
		}
		_spec.Edges.Add = append(_spec.Edges.Add, edge)
	}
	if _node, err = sqlgraph.UpdateNodes(ctx, _u.driver, _spec); err != nil {
		if _, ok := err.(*sqlgraph.NotFoundError); ok {
			err = &NotFoundError{llminteraction.Label}
		} else if sqlgraph.IsConstraintError(err) {
			err = &ConstraintError{msg: err.Error(), wrap: err}
		}
		return 0, err
	}
	_u.mutation.done = true
	return _node, nil
}

// LLMInteractionUpdateOne is the builder for updating a single LLMInteraction entity.
type LLMInteractionUpdateOne struct {
	config
	fields   []string
	hooks    []Hook
	mutation *LLMInteractionMutation
}

// SetInteractionType sets the "interaction_type" field.
func (_u *LLMInteractionUpdateOne) SetInteractionType(v llminteraction.InteractionType) *LLMInteractionUpdateOne {
	_u.mutation.SetInteractionType(v)
	return _u
}

// SetNillableInteractionType sets the "interaction_type" field if the given value is not nil.
func (_u *LLMInteractionUpdateOne) SetNillableInteractionType(v *llminteraction.InteractionType) *LLMInteractionUpdateOne {
	if v != nil {
		_u.SetInteractionType(*v)
	}
	return _u
}

// SetModelName sets the "model_name" field.
func (_u *LLMInteractionUpdateOne) SetModelName(v string) *LLMInteractionUpdateOne {
	_u.mutation.SetModelName(v)
	return _u
}

// SetNillableModelName sets the "model_name" field if the given value is not nil.
func (_u *LLMInteractionUpdateOne) SetNillableModelName(v *string) *LLMInteractionUpdateOne {
	if v != nil {
		_u.SetModelName(*v)
	}
	return _u
}

// SetLastMessageID sets the "last_message_id" field.
func (_u *LLMInteractionUpdateOne) SetLastMessageID(v string) *LLMInteractionUpdateOne {
	_u.mutation.SetLastMessageID(v)
	return _u
}

// SetNillableLastMessageID sets the "last_message_id" field if the given value is not nil.
func (_u *LLMInteractionUpdateOne) SetNillableLastMessageID(v *string) *LLMInteractionUpdateOne {
	if v != nil {
		_u.SetLastMessageID(*v)
	}
	return _u
}

// ClearLastMessageID clears the value of the "last_message_id" field.
func (_u *LLMInteractionUpdateOne) ClearLastMessageID() *LLMInteractionUpdateOne {
	_u.mutation.ClearLastMessageID()
	return _u
}

// SetLlmRequest sets the "llm_request" field.
func (_u *LLMInteractionUpdateOne) SetLlmRequest(v map[string]interface{}) *LLMInteractionUpdateOne {
	_u.mutation.SetLlmRequest(v)
	return _u
}

// SetLlmResponse sets the "llm_response" field.
func (_u *LLMInteractionUpdateOne) SetLlmResponse(v map[string]interface{}) *LLMInteractionUpdateOne {
	_u.mutation.SetLlmResponse(v)
	return _u
}

// SetThinkingContent sets the "thinking_content" field.
func (_u *LLMInteractionUpdateOne) SetThinkingContent(v string) *LLMInteractionUpdateOne {
	_u.mutation.SetThinkingContent(v)
	return _u
}

// SetNillableThinkingContent sets the "thinking_content" field if the given value is not nil.
func (_u *LLMInteractionUpdateOne) SetNillableThinkingContent(v *string) *LLMInteractionUpdateOne {
	if v != nil {
		_u.SetThinkingContent(*v)
	}
	return _u
}

// ClearThinkingContent clears the value of the "thinking_content" field.
func (_u *LLMInteractionUpdateOne) ClearThinkingContent() *LLMInteractionUpdateOne {
	_u.mutation.ClearThinkingContent()
	return _u
}

// SetResponseMetadata sets the "response_metadata" field.
func (_u *LLMInteractionUpdateOne) SetResponseMetadata(v map[string]interface{}) *LLMInteractionUpdateOne {
	_u.mutation.SetResponseMetadata(v)
	return _u
}

// ClearResponseMetadata clears the value of the "response_metadata" field.
func (_u *LLMInteractionUpdateOne) ClearResponseMetadata() *LLMInteractionUpdateOne {
	_u.mutation.ClearResponseMetadata()
	return _u
}

// SetInputTokens sets the "input_tokens" field.
func (_u *LLMInteractionUpdateOne) SetInputTokens(v int) *LLMInteractionUpdateOne {
	_u.mutation.ResetInputTokens()
	_u.mutation.SetInputTokens(v)
	return _u
}

// SetNillableInputTokens sets the "input_tokens" field if the given value is not nil.
func (_u *LLMInteractionUpdateOne) SetNillableInputTokens(v *int) *LLMInteractionUpdateOne {
	if v != nil {
		_u.SetInputTokens(*v)
	}
	return _u
}

// AddInputTokens adds value to the "input_tokens" field.
func (_u *LLMInteractionUpdateOne) AddInputTokens(v int) *LLMInteractionUpdateOne {
	_u.mutation.AddInputTokens(v)
	return _u
}

// ClearInputTokens clears the value of the "input_tokens" field.
func (_u *LLMInteractionUpdateOne) ClearInputTokens() *LLMInteractionUpdateOne {
	_u.mutation.ClearInputTokens()
	return _u
}

// SetOutputTokens sets the "output_tokens" field.
func (_u *LLMInteractionUpdateOne) SetOutputTokens(v int) *LLMInteractionUpdateOne {
	_u.mutation.ResetOutputTokens()
	_u.mutation.SetOutputTokens(v)
	return _u
}

// SetNillableOutputTokens sets the "output_tokens" field if the given value is not nil.
func (_u *LLMInteractionUpdateOne) SetNillableOutputTokens(v *int) *LLMInteractionUpdateOne {
	if v != nil {
		_u.SetOutputTokens(*v)
	}
	return _u
}

// AddOutputTokens adds value to the "output_tokens" field.
func (_u *LLMInteractionUpdateOne) AddOutputTokens(v int) *LLMInteractionUpdateOne {
	_u.mutation.AddOutputTokens(v)
	return _u
}

// ClearOutputTokens clears the value of the "output_tokens" field.
func (_u *LLMInteractionUpdateOne) ClearOutputTokens() *LLMInteractionUpdateOne {
	_u.mutation.ClearOutputTokens()
	return _u
}

// SetTotalTokens sets the "total_tokens" field.
func (_u *LLMInteractionUpdateOne) SetTotalTokens(v int) *LLMInteractionUpdateOne {
	_u.mutation.ResetTotalTokens()
	_u.mutation.SetTotalTokens(v)
	return _u
}

// SetNillableTotalTokens sets the "total_tokens" field if the given value is not nil.
func (_u *LLMInteractionUpdateOne) SetNillableTotalTokens(v *int) *LLMInteractionUpdateOne {
	if v != nil {
		_u.SetTotalTokens(*v)
	}
	return _u
}

// AddTotalTokens adds value to the "total_tokens" field.
func (_u *LLMInteractionUpdateOne) AddTotalTokens(v int) *LLMInteractionUpdateOne {
	_u.mutation.AddTotalTokens(v)
	return _u
}

// ClearTotalTokens clears the value of the "total_tokens" field.
func (_u *LLMInteractionUpdateOne) ClearTotalTokens() *LLMInteractionUpdateOne {
	_u.mutation.ClearTotalTokens()
	return _u
}

// SetDurationMs sets the "duration_ms" field.
func (_u *LLMInteractionUpdateOne) SetDurationMs(v int) *LLMInteractionUpdateOne {
	_u.mutation.ResetDurationMs()
	_u.mutation.SetDurationMs(v)
	return _u
}

// SetNillableDurationMs sets the "duration_ms" field if the given value is not nil.
func (_u *LLMInteractionUpdateOne) SetNillableDurationMs(v *int) *LLMInteractionUpdateOne {
	if v != nil {
		_u.SetDurationMs(*v)
	}
	return _u
}

// AddDurationMs adds value to the "duration_ms" field.
func (_u *LLMInteractionUpdateOne) AddDurationMs(v int) *LLMInteractionUpdateOne {
	_u.mutation.AddDurationMs(v)
	return _u
}

// ClearDurationMs clears the value of the "duration_ms" field.
func (_u *LLMInteractionUpdateOne) ClearDurationMs() *LLMInteractionUpdateOne {
	_u.mutation.ClearDurationMs()
	return _u
}

// SetErrorMessage sets the "error_message" field.
func (_u *LLMInteractionUpdateOne) SetErrorMessage(v string) *LLMInteractionUpdateOne {
	_u.mutation.SetErrorMessage(v)
	return _u
}

// SetNillableErrorMessage sets the "error_message" field if the given value is not nil.
func (_u *LLMInteractionUpdateOne) SetNillableErrorMessage(v *string) *LLMInteractionUpdateOne {
	if v != nil {
		_u.SetErrorMessage(*v)
	}
	return _u
}

// ClearErrorMessage clears the value of the "error_message" field.
func (_u *LLMInteractionUpdateOne) ClearErrorMessage() *LLMInteractionUpdateOne {
	_u.mutation.ClearErrorMessage()
	return _u
}

// SetLastMessage sets the "last_message" edge to the Message entity.
func (_u *LLMInteractionUpdateOne) SetLastMessage(v *Message) *LLMInteractionUpdateOne {
	return _u.SetLastMessageID(v.ID)
}

// AddTimelineEventIDs adds the "timeline_events" edge to the TimelineEvent entity by IDs.
func (_u *LLMInteractionUpdateOne) AddTimelineEventIDs(ids ...string) *LLMInteractionUpdateOne {
	_u.mutation.AddTimelineEventIDs(ids...)
	return _u
}

// AddTimelineEvents adds the "timeline_events" edges to the TimelineEvent entity.
func (_u *LLMInteractionUpdateOne) AddTimelineEvents(v ...*TimelineEvent) *LLMInteractionUpdateOne {
	ids := make([]string, len(v))
	for i := range v {
		ids[i] = v[i].ID
	}
	return _u.AddTimelineEventIDs(ids...)
}

// Mutation returns the LLMInteractionMutation object of the builder.
func (_u *LLMInteractionUpdateOne) Mutation() *LLMInteractionMutation {
	return _u.mutation
}

// ClearLastMessage clears the "last_message" edge to the Message entity.
func (_u *LLMInteractionUpdateOne) ClearLastMessage() *LLMInteractionUpdateOne {
	_u.mutation.ClearLastMessage()
	return _u
}

// ClearTimelineEvents clears all "timeline_events" edges to the TimelineEvent entity.
func (_u *LLMInteractionUpdateOne) ClearTimelineEvents() *LLMInteractionUpdateOne {
	_u.mutation.ClearTimelineEvents()
	return _u
}

// RemoveTimelineEventIDs removes the "timeline_events" edge to TimelineEvent entities by IDs.
func (_u *LLMInteractionUpdateOne) RemoveTimelineEventIDs(ids ...string) *LLMInteractionUpdateOne {
	_u.mutation.RemoveTimelineEventIDs(ids...)
	return _u
}

// RemoveTimelineEvents removes "timeline_events" edges to TimelineEvent entities.
func (_u *LLMInteractionUpdateOne) RemoveTimelineEvents(v ...*TimelineEvent) *LLMInteractionUpdateOne {
	ids := make([]string, len(v))
	for i := range v {
		ids[i] = v[i].ID
	}
	return _u.RemoveTimelineEventIDs(ids...)
}

// Where appends a list predicates to the LLMInteractionUpdate builder.
func (_u *LLMInteractionUpdateOne) Where(ps ...predicate.LLMInteraction) *LLMInteractionUpdateOne {
	_u.mutation.Where(ps...)
	return _u
}

// Select allows selecting one or more fields (columns) of the returned entity.
// The default is selecting all fields defined in the entity schema.
func (_u *LLMInteractionUpdateOne) Select(field string, fields ...string) *LLMInteractionUpdateOne {
	_u.fields = append([]string{field}, fields...)
	return _u
}

// Save executes the query and returns the updated LLMInteraction entity.
func (_u *LLMInteractionUpdateOne) Save(ctx context.Context) (*LLMInteraction, error) {
	return withHooks(ctx, _u.sqlSave, _u.mutation, _u.hooks)
}

// SaveX is like Save, but panics if an error occurs.
func (_u *LLMInteractionUpdateOne) SaveX(ctx context.Context) *LLMInteraction {
	node, err := _u.Save(ctx)
	if err != nil {
		panic(err)
	}
	return node
}

// Exec executes the query on the entity.
func (_u *LLMInteractionUpdateOne) Exec(ctx context.Context) error {
	_, err := _u.Save(ctx)
	return err
}

// ExecX is like Exec, but panics if an error occurs.
func (_u *LLMInteractionUpdateOne) ExecX(ctx context.Context) {
	if err := _u.Exec(ctx); err != nil {
		panic(err)
	}
}

// check runs all checks and user-defined validators on the builder.
func (_u *LLMInteractionUpdateOne) check() error {
	if v, ok := _u.mutation.InteractionType(); ok {
		if err := llminteraction.InteractionTypeValidator(v); err != nil {
			return &ValidationError{Name: "interaction_type", err: fmt.Errorf(`ent: validator failed for field "LLMInteraction.interaction_type": %w`, err)}
		}
	}
	if _u.mutation.SessionCleared() && len(_u.mutation.SessionIDs()) > 0 {
		return errors.New(`ent: clearing a required unique edge "LLMInteraction.session"`)
	}
	if _u.mutation.StageCleared() && len(_u.mutation.StageIDs()) > 0 {
		return errors.New(`ent: clearing a required unique edge "LLMInteraction.stage"`)
	}
	if _u.mutation.AgentExecutionCleared() && len(_u.mutation.AgentExecutionIDs()) > 0 {
		return errors.New(`ent: clearing a required unique edge "LLMInteraction.agent_execution"`)
	}
	return nil
}

func (_u *LLMInteractionUpdateOne) sqlSave(ctx context.Context) (_node *LLMInteraction, err error) {
	if err := _u.check(); err != nil {
		return _node, err
	}
	_spec := sqlgraph.NewUpdateSpec(llminteraction.Table, llminteraction.Columns, sqlgraph.NewFieldSpec(llminteraction.FieldID, field.TypeString))
	id, ok := _u.mutation.ID()
	if !ok {
		return nil, &ValidationError{Name: "id", err: errors.New(`ent: missing "LLMInteraction.id" for update`)}
	}
	_spec.Node.ID.Value = id
	if fields := _u.fields; len(fields) > 0 {
		_spec.Node.Columns = make([]string, 0, len(fields))
		_spec.Node.Columns = append(_spec.Node.Columns, llminteraction.FieldID)
		for _, f := range fields {
			if !llminteraction.ValidColumn(f) {
				return nil, &ValidationError{Name: f, err: fmt.Errorf("ent: invalid field %q for query", f)}
			}
			if f != llminteraction.FieldID {
				_spec.Node.Columns = append(_spec.Node.Columns, f)
			}
		}
	}
	if ps := _u.mutation.predicates; len(ps) > 0 {
		_spec.Predicate = func(selector *sql.Selector) {
			for i := range ps {
				ps[i](selector)
			}
		}
	}
	if value, ok := _u.mutation.InteractionType(); ok {
		_spec.SetField(llminteraction.FieldInteractionType, field.TypeEnum, value)
	}
	if value, ok := _u.mutation.ModelName(); ok {
		_spec.SetField(llminteraction.FieldModelName, field.TypeString, value)
	}
	if value, ok := _u.mutation.LlmRequest(); ok {
		_spec.SetField(llminteraction.FieldLlmRequest, field.TypeJSON, value)
	}
	if value, ok := _u.mutation.LlmResponse(); ok {
		_spec.SetField(llminteraction.FieldLlmResponse, field.TypeJSON, value)
	}
	if value, ok := _u.mutation.ThinkingContent(); ok {
		_spec.SetField(llminteraction.FieldThinkingContent, field.TypeString, value)
	}
	if _u.mutation.ThinkingContentCleared() {
		_spec.ClearField(llminteraction.FieldThinkingContent, field.TypeString)
	}
	if value, ok := _u.mutation.ResponseMetadata(); ok {
		_spec.SetField(llminteraction.FieldResponseMetadata, field.TypeJSON, value)
	}
	if _u.mutation.ResponseMetadataCleared() {
		_spec.ClearField(llminteraction.FieldResponseMetadata, field.TypeJSON)
	}
	if value, ok := _u.mutation.InputTokens(); ok {
		_spec.SetField(llminteraction.FieldInputTokens, field.TypeInt, value)
	}
	if value, ok := _u.mutation.AddedInputTokens(); ok {
		_spec.AddField(llminteraction.FieldInputTokens, field.TypeInt, value)
	}
	if _u.mutation.InputTokensCleared() {
		_spec.ClearField(llminteraction.FieldInputTokens, field.TypeInt)
	}
	if value, ok := _u.mutation.OutputTokens(); ok {
		_spec.SetField(llminteraction.FieldOutputTokens, field.TypeInt, value)
	}
	if value, ok := _u.mutation.AddedOutputTokens(); ok {
		_spec.AddField(llminteraction.FieldOutputTokens, field.TypeInt, value)
	}
	if _u.mutation.OutputTokensCleared() {
		_spec.ClearField(llminteraction.FieldOutputTokens, field.TypeInt)
	}
	if value, ok := _u.mutation.TotalTokens(); ok {
		_spec.SetField(llminteraction.FieldTotalTokens, field.TypeInt, value)
	}
	if value, ok := _u.mutation.AddedTotalTokens(); ok {
		_spec.AddField(llminteraction.FieldTotalTokens, field.TypeInt, value)
	}
	if _u.mutation.TotalTokensCleared() {
		_spec.ClearField(llminteraction.FieldTotalTokens, field.TypeInt)
	}
	if value, ok := _u.mutation.DurationMs(); ok {
		_spec.SetField(llminteraction.FieldDurationMs, field.TypeInt, value)
	}
	if value, ok := _u.mutation.AddedDurationMs(); ok {
		_spec.AddField(llminteraction.FieldDurationMs, field.TypeInt, value)
	}
	if _u.mutation.DurationMsCleared() {
		_spec.ClearField(llminteraction.FieldDurationMs, field.TypeInt)
	}
	if value, ok := _u.mutation.ErrorMessage(); ok {
		_spec.SetField(llminteraction.FieldErrorMessage, field.TypeString, value)
	}
	if _u.mutation.ErrorMessageCleared() {
		_spec.ClearField(llminteraction.FieldErrorMessage, field.TypeString)
	}
	if _u.mutation.LastMessageCleared() {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.M2O,
			Inverse: true,
			Table:   llminteraction.LastMessageTable,
			Columns: []string{llminteraction.LastMessageColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(message.FieldID, field.TypeString),
			},
		}
		_spec.Edges.Clear = append(_spec.Edges.Clear, edge)
	}
	if nodes := _u.mutation.LastMessageIDs(); len(nodes) > 0 {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.M2O,
			Inverse: true,
			Table:   llminteraction.LastMessageTable,
			Columns: []string{llminteraction.LastMessageColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(message.FieldID, field.TypeString),
			},
		}
		for _, k := range nodes {
			edge.Target.Nodes = append(edge.Target.Nodes, k)
		}
		_spec.Edges.Add = append(_spec.Edges.Add, edge)
	}
	if _u.mutation.TimelineEventsCleared() {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.O2M,
			Inverse: false,
			Table:   llminteraction.TimelineEventsTable,
			Columns: []string{llminteraction.TimelineEventsColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(timelineevent.FieldID, field.TypeString),
			},
		}
		_spec.Edges.Clear = append(_spec.Edges.Clear, edge)
	}
	if nodes := _u.mutation.RemovedTimelineEventsIDs(); len(nodes) > 0 && !_u.mutation.TimelineEventsCleared() {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.O2M,
			Inverse: false,
			Table:   llminteraction.TimelineEventsTable,
			Columns: []string{llminteraction.TimelineEventsColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(timelineevent.FieldID, field.TypeString),
			},
		}
		for _, k := range nodes {
			edge.Target.Nodes = append(edge.Target.Nodes, k)
		}
		_spec.Edges.Clear = append(_spec.Edges.Clear, edge)
	}
	if nodes := _u.mutation.TimelineEventsIDs(); len(nodes) > 0 {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.O2M,
			Inverse: false,
			Table:   llminteraction.TimelineEventsTable,
			Columns: []string{llminteraction.TimelineEventsColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(timelineevent.FieldID, field.TypeString),
			},
		}
		for _, k := range nodes {
			edge.Target.Nodes = append(edge.Target.Nodes, k)
		}
		_spec.Edges.Add = append(_spec.Edges.Add, edge)
	}
	_node = &LLMInteraction{config: _u.config}
	_spec.Assign = _node.assignValues
	_spec.ScanValues = _node.scanValues
	if err = sqlgraph.UpdateNode(ctx, _u.driver, _spec); err != nil {
		if _, ok := err.(*sqlgraph.NotFoundError); ok {
			err = &NotFoundError{llminteraction.Label}
		} else if sqlgraph.IsConstraintError(err) {
			err = &ConstraintError{msg: err.Error(), wrap: err}
		}
		return nil, err
	}
	_u.mutation.done = true
	return _node, nil
}
