apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: tarsy-secrets
  annotations:
    description: "TARSy secrets â€” created from environment variables"
parameters:
  - name: NAMESPACE
    value: "tarsy"
  - name: GOOGLE_API_KEY
    description: "Google API key for Gemini"
    required: true
  - name: GITHUB_TOKEN
    description: "GitHub token for runbook access"
    required: true
  - name: OPENAI_API_KEY
    value: ""
  - name: ANTHROPIC_API_KEY
    value: ""
  - name: XAI_API_KEY
    value: ""
  - name: VERTEX_AI_PROJECT
    value: ""
  - name: GOOGLE_SERVICE_ACCOUNT_KEY
    description: "GCP service account JSON (base64)"
    value: ""
  - name: SLACK_BOT_TOKEN
    description: "Slack bot token for notifications"
    value: ""
  - name: DATABASE_PASSWORD
    generate: expression
    from: "[a-zA-Z0-9]{16}"
  - name: DATABASE_USER
    value: "tarsy"
  - name: DATABASE_NAME
    value: "tarsy"
  - name: DATABASE_HOST
    value: "tarsy-database"
  - name: DATABASE_PORT
    value: "5432"
  - name: OAUTH2_CLIENT_ID
    required: true
  - name: OAUTH2_CLIENT_SECRET
    required: true
  - name: OAUTH2_COOKIE_SECRET
    generate: expression
    from: "[a-zA-Z0-9]{32}"
objects:
  - apiVersion: v1
    kind: Secret
    metadata:
      name: tarsy-secrets
      namespace: ${NAMESPACE}
      labels:
        app: tarsy
    type: Opaque
    stringData:
      google-api-key: ${GOOGLE_API_KEY}
      github-token: ${GITHUB_TOKEN}
      openai-api-key: ${OPENAI_API_KEY}
      anthropic-api-key: ${ANTHROPIC_API_KEY}
      xai-api-key: ${XAI_API_KEY}
      vertex-ai-project: ${VERTEX_AI_PROJECT}
      slack-bot-token: ${SLACK_BOT_TOKEN}
  - apiVersion: v1
    kind: Secret
    metadata:
      name: database-secret
      namespace: ${NAMESPACE}
      labels:
        app: tarsy
    type: Opaque
    stringData:
      password: ${DATABASE_PASSWORD}
      username: ${DATABASE_USER}
      database: ${DATABASE_NAME}
      database-url: postgresql://${DATABASE_USER}:${DATABASE_PASSWORD}@${DATABASE_HOST}:${DATABASE_PORT}/${DATABASE_NAME}
  - apiVersion: v1
    kind: Secret
    metadata:
      name: oauth2-proxy-secret
      namespace: ${NAMESPACE}
      labels:
        app: tarsy
    type: Opaque
    stringData:
      client-id: ${OAUTH2_CLIENT_ID}
      client-secret: ${OAUTH2_CLIENT_SECRET}
      cookie-secret: ${OAUTH2_COOKIE_SECRET}
  - apiVersion: v1
    kind: Secret
    metadata:
      name: gcp-service-account-secret
      namespace: ${NAMESPACE}
      labels:
        app: tarsy
    type: Opaque
    data:
      service-account-key.json: ${GOOGLE_SERVICE_ACCOUNT_KEY}
